# Changelog

## [2.1.0] - 2024-01-15

### 🆕 ویژگی‌های جدید

#### اسکن هوشمند
- **تنظیم جدید**: `SCAN_INTERVAL_MINUTES=30` (فاصله زمانی اسکن)
- **تنظیم جدید**: `RESUME_FROM_LAST_MESSAGE=true` (ادامه از آخرین پیام)
- **تنظیم جدید**: `SHOW_REMAINING_TIME=true` (نمایش زمان باقی‌مانده)
- **تابع جدید**: `should_scan_group()` برای بررسی زمان اسکن
- **تابع جدید**: `get_resume_message_id()` برای دریافت ID پیام ادامه
- **تابع جدید**: `format_remaining_time()` برای فرمت کردن زمان باقی‌مانده

#### مستندات جدید
- **`SMART_SCANNING_FEATURE.md`**: راهنمای کامل ویژگی اسکن هوشمند

### 🔧 تغییرات فنی

#### تنظیمات
- اضافه شدن `scan_interval_minutes` به `AnalysisConfig`
- اضافه شدن `resume_from_last_message` به `AnalysisConfig`
- اضافه شدن `show_remaining_time` به `AnalysisConfig`
- به‌روزرسانی `env.example` با تنظیمات جدید

#### منطق برنامه
- بهبود تابع `analyze_single_chat()` برای پشتیبانی از اسکن هوشمند
- اضافه شدن بررسی زمان آخرین اسکن
- اضافه شدن منطق ادامه از آخرین پیام
- بهبود آمار نهایی با شمارش اسکن‌های رد شده

### 📊 مزایا

1. **بهینه‌سازی منابع**: جلوگیری از اسکن‌های غیرضروری
2. **ادامه هوشمند**: ادامه از آخرین پیام اسکن شده
3. **قابلیت تنظیم**: فاصله زمانی قابل تنظیم
4. **نمایش وضعیت**: نمایش زمان باقی‌مانده
5. **آمار دقیق**: گزارش کامل از انواع مختلف رد شدن

### 🔄 نحوه استفاده

#### تنظیم فاصله زمانی
```bash
# اسکن هر 15 دقیقه
SCAN_INTERVAL_MINUTES=15

# اسکن هر 2 ساعت
SCAN_INTERVAL_MINUTES=120
```

#### غیرفعال‌سازی ادامه از آخرین پیام
```bash
RESUME_FROM_LAST_MESSAGE=false
```

#### غیرفعال‌سازی نمایش زمان باقی‌مانده
```bash
SHOW_REMAINING_TIME=false
```

### 📝 نکات مهم

- **اولویت زمانی**: اگر گروه اخیراً اسکن شده، رد می‌شود
- **ادامه هوشمند**: از پیام بعدی آخرین پیام شروع می‌شود
- **نمایش وضعیت**: زمان باقی‌مانده نمایش داده می‌شود
- **آمار دقیق**: انواع مختلف رد شدن شمارش می‌شود
- **قابلیت تنظیم**: تمام پارامترها قابل تنظیم هستند

## [2.0.0] - 2024-01-15

### 🆕 ویژگی‌های جدید

#### خواندن گروه‌ها از دیتابیس MongoDB
- **تنظیم جدید**: `USE_DATABASE_FOR_GROUPS=true/false`
- **تابع جدید**: `get_all_groups()` در `mongo_service.py`
- **تابع جدید**: `get_groups_by_type()` در `mongo_service.py`
- **تابع جدید**: `get_groups_from_database()` در `main.py`
- **تابع جدید**: `get_groups_from_file()` در `main.py`

#### اسکریپت‌های جدید
- **`migrate_groups_to_db.py`**: انتقال گروه‌ها از فایل به دیتابیس

#### مستندات جدید
- **`DATABASE_GROUPS_FEATURE.md`**: راهنمای کامل ویژگی دیتابیس
- **به‌روزرسانی `README.md`**: اضافه کردن اطلاعات ویژگی جدید

### 🔧 تغییرات فنی

#### تنظیمات
- اضافه شدن `use_database_for_groups` به `AnalysisConfig`
- به‌روزرسانی `env.example` با تنظیم جدید

#### منطق برنامه
- تغییر تابع `main()` برای پشتیبانی از خواندن از دیتابیس
- اضافه شدن منطق فال‌بک (fallback) بین دیتابیس و فایل
- بهبود لاگ‌ها برای نمایش منبع گروه‌ها

### 📊 مزایا

1. **مدیریت بهتر گروه‌ها**: گروه‌ها در دیتابیس ذخیره می‌شوند
2. **عدم وابستگی به فایل**: نیازی به نگهداری فایل `links.txt` نیست
3. **قابلیت جستجو**: امکان جستجو در گروه‌ها بر اساس معیارهای مختلف
4. **آمار و گزارش**: امکان دریافت آمار از گروه‌های ذخیره شده
5. **سازگاری**: با کد قبلی سازگار است

### 🔄 نحوه استفاده

#### فعال‌سازی خواندن از دیتابیس
```bash
# در فایل .env
USE_DATABASE_FOR_GROUPS=true
```

#### غیرفعال‌سازی و استفاده از فایل
```bash
# در فایل .env
USE_DATABASE_FOR_GROUPS=false
```

### 🧪 تست

```bash
# انتقال گروه‌ها از فایل به دیتابیس
python analyzer/migrate_groups_to_db.py
```

### 📝 نکات مهم

- **اولویت دیتابیس**: اگر `USE_DATABASE_FOR_GROUPS=true` باشد، ابتدا دیتابیس بررسی می‌شود
- **فال‌بک**: در صورت عدم وجود گروه در منبع اول، منبع دوم بررسی می‌شود
- **سازگاری**: این تغییر با کد قبلی سازگار است
- **لاگ**: تمام عملیات در لاگ‌ها ثبت می‌شود

## [1.0.0] - 2024-01-01

### ویژگی‌های اولیه
- تحلیل گروه‌ها و کانال‌های تلگرام
- استخراج پیام‌ها و کاربران
- تشخیص و استخراج لینک‌ها
- ذخیره در MongoDB
- پشتیبانی از Docker 